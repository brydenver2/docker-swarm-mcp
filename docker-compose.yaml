version: '3.8'

services:
  mcp-server:
    build: .
    container_name: docker-mcp-server
    ports:
      - "8000:8000"
    environment:
      - MCP_ACCESS_TOKEN=${MCP_ACCESS_TOKEN}
      - DOCKER_HOST=${DOCKER_HOST:-unix:///var/run/docker.sock}
      - DOCKER_TLS_VERIFY=${DOCKER_TLS_VERIFY:-0}
      - DOCKER_CERT_PATH=${DOCKER_CERT_PATH:-}
      - MCP_TRANSPORT=${MCP_TRANSPORT:-http}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-*}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ${DOCKER_CERT_PATH:-/tmp}:${DOCKER_CERT_PATH:-/tmp}:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/mcp/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
